),
snap = "in",
mask = T
) |>
terra::aggregate(
fact = 5,
fun = "modal"
) |>
terra::project(crs)
#Save this files locally
terra::writeRaster(
land_cover,
paste0(
raster,
"_venezuela",
".tif"
),
overwrite=T
)
}
r_list <- list.files(
path = getwd(),
pattern = "_venezuela.tif",
full.names = T
)
land_cover_vrt <- terra::vrt(
r_list,
"venezuela_land_cover_vrt.vrt",
overwrite = T
)
ras <- terra::rast(
raster_files[[1]]
)
raster_color_table <- do.call(
data.frame,
terra::coltab(ras)
)
hex_code <- ggtern::rgb2hex(
r = raster_color_table[,2],
g = raster_color_table[,3],
b = raster_color_table[,4]
)
cols <- hex_code[c(2:3, 5:6, 8:12)]
from <- c(1:2, 4:5, 7:11)
to <- t(col2rgb(cols))
land_cover_vrt <- na.omit(land_cover_vrt)
land_cover_venezuela <- terra::subst(
land_cover_vrt,
from = from,
to = to,
names = cols
)
terra::plotRGB(land_cover_venezuela)
elev <- elevatr::get_elev_raster(
locations = country_sf,
z = 6, clip = "locations"
)
crs_lambert <- "+proj=laea +lat_0=7 +lon_0=-66 +datum=WGS84 +units=m +no_defs"
land_cover_venezuela_resampled <- terra::resample(
x = land_cover_venezuela,
y = terra::rast(elev),
method = "near"
) |>
terra::project(crs_lambert)
terra::plotRGB(land_cover_venezuela_resampled)
img_file <- "land_cover_venezuela_esq.png"
terra::writeRaster(
land_cover_venezuela_resampled,
img_file,
overwrite = T,
NAflag = 255
)
img <- png::readPNG(img_file)
eleve_lambert <- elev |>
terra::rast() |>
terra::project(crs_lambert)
elmat <- rayshader::raster_to_matrix(
eleve_lambert
)
h <- nrow(eleve_lambert)
w <- ncol(eleve_lambert)
elmat |>
rayshader::height_shade(
texture = colorRampPalette(
cols[9]
)(256)
) |>
rayshader::add_overlay(
img,
alphalayer = 1
) |>
rayshader::plot_3d(
elmat,
zscale = 60,
solid = F,
shadow = T,
shadow_darkness = 1,
background= "white",
windowsize = c(
600, 600
),
zoom = .75,
phi = 89,
theta = 0
)
u <- "https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/4k/air_museum_playground_4k.hdr"
hdri_file <- basename(u)
filename <- "3d_land_cover_venezuela_esq.png"
filename <- "3d_land_cover_venezuela_esq_test.png"
rayshader::render_highquality(
filename = filename,
preview = F, # Desactiva la previsualización al final, solo para el render final
# Iluminación
light = F,
environment_light = hdri_file,
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 225,         # Nuevo ángulo para probar
# Post-Procesamiento y Acabado
fov = 0,                  # Proyección Ortográfica
shadow_darkness = 0.25,   # Sombras más suaves
shadow_ambient = 0.8,     # Más luz en áreas sombreadas
# Calidad y Resolución
width = w * 3,            # Aumentar la resolución
height = h * 3,           # Aumentar la resolución
samples = 500,            # Más muestras para reducir el ruido
# Rendimiento
parallel = T,
progression_mode = "decent"
)
rayshader::render_highquality(
filename = filename,
preview = F, # Desactiva la previsualización al final, solo para el render final
# Iluminación
light = F,
environment_light = hdri_file,
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 225,         # Nuevo ángulo para probar
# Post-Procesamiento y Acabado
shadow_darkness = 0.25,   # Sombras más suaves
shadow_ambient = 0.8,     # Más luz en áreas sombreadas
# Calidad y Resolución
width = w * 3,            # Aumentar la resolución
height = h * 3,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
progression_mode = "decent"
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = hdri_file,
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 225,         # Nuevo ángulo para probar
# Post-Procesamiento y Acabado
shadow_darkness = 0.25,   # Sombras más suaves
shadow_ambient = 0.8,     # Más luz en áreas sombreadas
# Calidad y Resolución
width = w * 3,            # Aumentar la resolución
height = h * 3,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = hdri_file,
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 225,         # Nuevo ángulo para probar
# Calidad y Resolución
parallel = T,
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = hdri_file,
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 225,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T
)
elmat |>
rayshader::height_shade(
texture = colorRampPalette(
cols[9]
)(256)
) |>
rayshader::add_overlay(
img,
alphalayer = 1
) |>
rayshader::plot_3d(
elmat,
zscale = 60,
solid = F,
shadow = T,
shadow_darkness = 0.8,
background= "white",
windowsize = c(
600, 600
),
zoom = .75,
phi = 89,
theta = 0
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = hdri_file,
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 90,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
interactive = F
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = "studio_small_03_4k.hdr",
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 90,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
interactive = F
)
elmat |>
rayshader::height_shade(
texture = colorRampPalette(
cols[9]
)(256)
) |>
rayshader::add_overlay(
img,
alphalayer = 1
) |>
rayshader::plot_3d(
elmat,
zscale = 60,
solid = F,
shadow = T,
shadow_darkness = 0.8,
background= "white",
windowsize = c(
600, 600
),
zoom = .75,
phi = 89,
theta = 0
)
elmat |>
rayshader::height_shade(
texture = colorRampPalette(
cols[9]
)(256)
) |>
rayshader::add_overlay(
img,
alphalayer = 1
) |>
rayshader::plot_3d(
elmat,
zscale = 60,
solid = F,
shadow = T,
shadow_darkness = 0.8,
background= "white",
windowsize = c(
w/2, h/2
),
zoom = .75,
phi = 89,
theta = 0
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = "studio_small_03_4k.hdr",
intensity_env = 0.7,      # Iluminación de entorno más suave
rotate_env = 90,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
interactive = F
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = "studio_small_03_4k.hdr",
intensity_env = 0.75,      # Iluminación de entorno más suave
rotate_env = 180,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
interactive = F
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = "phalzer_forest_01_4k.hdr",
intensity_env = 0.75,      # Iluminación de entorno más suave
rotate_env = 225,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
interactive = F
)
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = "phalzer_forest_01_4k.hdr",
intensity_env = 1.5,      # Iluminación de entorno más suave
rotate_env = 225,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 1.5,            # Aumentar la resolución
height = h * 1.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
interactive = F
)
filename <- "3d_land_cover_venezuela_esq_test3.png"
rayshader::render_highquality(
filename = filename,
preview = T,
# Iluminación
light = F,
environment_light = "phalzer_forest_01_4k.hdr",
intensity_env = 1.5,      # Iluminación de entorno más suave
rotate_env = 45,         # Nuevo ángulo para probar
# Calidad y Resolución
width = w * 2.5,            # Aumentar la resolución
height = h * 2.5,           # Aumentar la resolución
samples = 400,            # Más muestras para reducir el ruido
sample_method = "sobol",
# Rendimiento
parallel = T,
interactive = F
)
raster_color_table
legend_name <- "land_cover_legend.png"
png(legend_name)
par(family = "serif")
plot(
NULL,
xaxt = "n",
yaxt = "n",
bty = "n",
ylab = "",
xlab = "",
xlim = 0:1,
ylim = 0:1,
xaxs = "i",
yaxs = "i"
)
legend(
"center",
legend = c(
"Water",
"Trees",
"Flooded",
"Crops",
"Built",
"Range"
),
pch = 15,
cex = 2,
pt.cex = 1,
bty = "n",
col = c(cols[c(1:5,9)]),
fill = c(cols[c(1:5,9)]),
border = "grey20"
)
dev.off()
lc_img <- magick::image_read(
filename
)
my_legend <- magick::image_read(
legend_name
)
my_legend_scaled <- magick::image_scale(
magick::image_background(
my_legend_scaled, "none"
), 3000
)
magick::image_write(
my_legend_scaled, "land_cover_legend_2.png"
)
my_legend <- magick::image_read(
legend_name
)
my_legend_scaled <- magick::image_scale(
magick::image_background(
my_legend, "none"
), 3000
)
magick::image_write(
my_legend_scaled, "land_cover_legend_2.png"
)
#### 1. Packages ####
libs <- c(
"terra",
"giscoR",
"sf",
"tidyverse",
"ggtern",
"elevatr",
"png",
"rayshader",
"magick"
)
installed_libraries <- libs %in% rownames(
installed.packages()
)
if(any(installed_libraries == F)) {
install.packages(
libs[!installed_libraries]
)
}
invisible(
lapply(
libs, library, character.only = T
)
)
#### 2. Country Borders ####
country_sf <- giscoR::gisco_get_countries(
country = "VE",
resolution = "1"
)
country_sf <- st_read("Estados_Venezuela.shp") |>
sf::st_as_sf() |>
st_transform(4326)
#### 3. Download Esri Land Cover Tiles ####
urls <- c( "https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/18P_20240101-20241231.tif",
"https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/18N_20240101-20241231.tif",
"https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/19P_20240101-20241231.tif",
"https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/19N_20240101-20241231.tif",
"https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/20P_20240101-20241231.tif",
"https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/20N_20240101-20241231.tif",
"https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/21P_20240101-20241231.tif",
"https://lulctimeseries.blob.core.windows.net/lulctimeseriesv003/lc2024/21N_20240101-20241231.tif")
options(timeout = 300)
for(url in urls) {
download.file(
url = url,
destfile = basename(url),
mode = "wb"
)
}
setwd("D:/Projects/sankey-diagram-alumnusb")
shiny::runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
rsconnect::deployApp()
runApp()
